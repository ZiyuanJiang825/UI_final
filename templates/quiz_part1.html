{% extends "layout.html" %}
<!-- 
    should include:
        1. a button to submit
            1.1 prompt to double check if submit
            1.2 double check if quesion1 selects one choice and question 2 selects at least one cell
            1.3 return answer back to backend and direct to answer page
        2. simulate a clickable grid
            2.1 can be 1*9 or 9*1 or 3*3, parameter: row and column
            2.2 each cell is divided into 3*3 smaller grids for candidates 1-9
        3. two questions
            3.1 a multiple choice to select only one choice
        4. render page
            4.1 receive from backend
                4.1.1 question based on id
 -->

{% block content %}
<script>
    let arrangement = {{question.arrangement|tojson}};
    let candidates = {{question.candidates|tojson}};
    let format = {{question.format|tojson}};
    let id = {{id|tojson}};

    function generateGrid() {
        var grid = "<table>";
        for ( row = 0; row < format[0]; row++ ) {
            grid += "<tr>"; 
            for ( col = 0; col < format[1]; col++ ) {      
                grid += "<td class='cell'>"
                let index = row*format[0] + col;
                if (arrangement[index] == 0){
                    let candidate = candidates[index];
                    grid += "<table>";
                    count = 1;
                    for ( row1 = 1; row1 <= 3; row1++){
                        grid += "<tr>";
                        for ( col1 = 1; col1 <= 3; col1++ ){
                            grid += "<td class='candidate'>";
                            if (candidate.includes(count)){
                                grid += count.toString();
                            }
                            grid += "</td>";
                            count += 1;
                        }
                        grid += "</tr>";    
                    }
                    grid += "</table></td>";
                } else {
                    grid += arrangement[index].toString();
                    grid += "</td>";
                }   
            }
            grid += "</tr>"; 
        }
        grid += "</table>";
        return grid;
    }

    $(document).ready(function(){
        $( "#tableContainer" ).append( generateGrid() );

        $( ".cell" ).click(function() {
            var index = $( "td" ).index( this );
            var row = Math.floor( ( index ) / 5) + 1;
            var col = ( index % 5 ) + 1;

            let bgcolor = $( this ).css( 'background-color');
            if (bgcolor == 'rgb(255, 0, 0)') {
                $( this ).css( 'background-color', 'white' );
            } else {
                $( this ).css( 'background-color', 'red' );
            }
        });

        $("#submit").click(function(){
            if(confirm("Are you sure you want to submit your answers?")){
                let link = "/answer/" + id.toString() + "/part1";
                console.log(link);
                window.location.assign(link);
            }
        })
    })
</script>

<div>
    <div class="row quiz">Question 1 Part 1</div>
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                1. Select one technique you will use to solve this puzzle
            </div>
            <select name="pattern" id="pattern">
                <option value="naked">Naked Pair</option>
                <option value="hidden">Hidden Pair</option>
                <option value="x-wing">X-wing</option>
              </select>
        </div>
        <div class="col-md-6">
            <div id="tableContainer"></div>
        </div>
    </div>
    <button id="submit">Submit</button>
</div>

{% endblock %}